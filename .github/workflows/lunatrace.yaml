name: LunaTrace

on:
  pull_request:
    branches: ['**']
    paths:
      - 'lunatrace/**'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - run: -|
          pushd lunatrace/bsl
          docker-compose up -d
          popd
          tools/service-scripts/wait-for-it.sh -h localhost -p 8080 -t 30
      - name: List inconsistencies
        uses: tibotiber/hasura-action@master
        with:
          args: metadata inconsistency list
        env:
          HASURA_ENDPOINT: localhost:8080
          HASURA_ADMIN_SECRET: myadminsecretkey
          HASURA_WORKDIR: lunatrace/bsl/hasura
          HASURA_ENGINE_VERSION: v2.2.2
