- id: "ory:lunatrace:hasura:protected"
  upstream:
    preserve_host: true
    url: "http://graphql-engine:8080"
  match:
    url: "http://localhost:4455/v1/graphql"
    methods:
      - POST
  authenticators:
    - handler: anonymous
  authorizer:
    handler: allow
  mutators:
    - handler: id_token
      config:
        issuer_url: http://oathkeeper:4455/
        claims: |
          {
            "https://hasura.io/jwt/claims": {
              "x-hasura-access-token": "{{ .MatchContext.Header.Get "X-LunaTrace-Access-Token" }}",
              "x-hasura-allowed-roles": ["cli"],
              "x-hasura-default-role": "cli"
            }
          }
